<UserControl x:Class="POS_display.wpf.View.DispenseList"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:POS_display.wpf.View"
             xmlns:wpf="clr-namespace:POS_display.wpf"
             xmlns:POS_display="clr-namespace:POS_display" xmlns:View="clr-namespace:POS_display.wpf.View"
             mc:Ignorable="d" 
             d:DesignHeight="200" d:DesignWidth="570">
    <UserControl.Resources>
        <ResourceDictionary>
            <wpf:BusyToCursorConverter x:Key="BusyToCursorConverter"/>
            <wpf:DateFormat x:Key="DateFormat"/>
            <wpf:NumberFormat x:Key="NumberFormat"/>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../style/defaultStyle.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <UserControl.Cursor>
        <Binding Path="DataContext.IsBusy" RelativeSource="{RelativeSource Self}" Converter="{StaticResource BusyToCursorConverter}"/>
    </UserControl.Cursor>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="30" />
            <RowDefinition Height="*" />
            <RowDefinition Height="30" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="95"/>
            <ColumnDefinition Width="95"/>
            <ColumnDefinition Width="95"/>
            <ColumnDefinition Width="95"/>
            <ColumnDefinition Width="85"/>
            <ColumnDefinition Width="105"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Button x:Name="btnSign" Grid.Row="0" Grid.Column="0" Content="Pasirašyti" Command="{Binding SignCommand}" IsEnabled="{Binding IsEnabled}" Width="90" Height="25"/>
        <Button x:Name="btnConfirm" Grid.Row="0" Grid.Column="1" Content="Patvirtinti" Command="{Binding ConfirmCommand}" IsEnabled="{Binding IsEnabled}" Width="90" Height="25"/>
        <Button x:Name="btnGetDispensePdf" Grid.Row="0" Grid.Column="2" Content="Parsisiųsti išd." Command="{Binding GetDispensePdfCommand}" IsEnabled="{Binding IsEnabled}" Width="90" Height="25"/>
        <Button x:Name="btnGetRecipePdf" Grid.Row="0" Grid.Column="3" Content="Parsisiųsti rec." Command="{Binding GetRecipePdfCommand}" IsEnabled="{Binding IsEnabled}" Width="90" Height="25"/>
        <CheckBox x:Name="cbSelAll" Content="Pasirinkti visus" Grid.Row="0" Grid.Column="5" VerticalAlignment="Center" HorizontalAlignment="Center" Checked="datagrid_selectAll" Unchecked="datagrid_unselectAll" IsEnabled="{Binding IsEnabled, Mode=OneWay}"/>
        <DataGrid x:Name="dataGrid">
            <DataGrid.Resources>
                <Style TargetType="{x:Type DataGrid}" BasedOn="{StaticResource defaultDataGrid}">
                    <EventSetter Event="Selector.SelectionChanged" Handler="dataGrid_SelectionChanged" />
                    <Setter Property="Grid.Row" Value="1"/>
                    <Setter Property="Grid.ColumnSpan" Value="7"/>
                    <Setter Property="ItemsSource" Value="{Binding DispenseList}"/>
                    <Setter Property="SelectionMode" Value="Extended"/>
                    <Setter Property="IsReadOnly" Value="True"/>
                    <Setter Property="ContextMenu">
                        <Setter.Value>
                            <ContextMenu>
                                <MenuItem Header="Redaguoti išdavimą" Command="{Binding EditCommand}"/>
                                <MenuItem Header="Atšaukti išdavimą" Command="{Binding CancelCommand}"/>
                                <MenuItem Header="Registruoti apsilankymą" Command="{Binding CreateEncounterCommand}"/>
                                <MenuItem Header="Paciento išdavimai" Command="{Binding PatientDispenseCommand}"/>
                                <MenuItem Header="Atnaujint duomenis" Command="{Binding UpdateDataCommand}"/>
                            </ContextMenu>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <Trigger Property="HasItems" Value="False">
                            <Setter Property="ContextMenu" Value="{x:Null}"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding IsContextMenuEnabled}" Value="False">
                            <Setter Property="ContextMenu" Value="{x:Null}"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
                <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource defaultDataGridCell}">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource Self}}" />
                            <Setter Property="Background" Value="#FFC7BDBD" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>
            <DataGrid.RowStyle>
                <Style TargetType="{x:Type DataGridRow}">
                    <Setter Property="Height" Value="Auto"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding selected}" Value="True">
                            <Setter Property="IsSelected" Value="True"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding selected}" Value="False">
                            <Setter Property="IsSelected" Value="False"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Dispense.Status}" Value="active">
                            <Setter Property="Foreground" Value="Green"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Dispense.StatusReasonCode}" Value="reserved">
                            <Setter Property="Foreground" Value="Blue"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Dispense.StatusReasonCode}" Value="for review">
                            <Setter Property="Foreground" Value="Red"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Dispense.Status}" Value="enteredinerror">
                            <Setter Property="Foreground" Value="Red"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Dispense.Status}" Value="stopped">
                            <Setter Property="Foreground" Value="Red"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTemplateColumn IsReadOnly="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding selected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Binding="{Binding CompositionId}" Header="Išdavimo nr." MinWidth="{Binding Path=ActualWidth, ElementName=CompositionId }" IsReadOnly="True"/>
                <DataGridTemplateColumn Header="Vaistininkas" Width="SizeToHeader" IsReadOnly="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding AuthorName}" 
                       ToolTip="{Binding OrganizationName}" 
                       Style="{StaticResource WrapTextBlock}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Binding="{Binding ProprietaryName}" ElementStyle="{StaticResource WrapTextBlock}" Header="Firminis pavadinimas" Width="*" IsReadOnly="True"/>
                <DataGridTextColumn Binding="{Binding DateWritten, Converter={StaticResource DateFormat}}" Header="Išdavimo data" MinWidth="{Binding Path=ActualWidth, ElementName=projectInfoHeader }" IsReadOnly="True"/>
                <DataGridTextColumn Binding="{Binding DateDueDate, Converter={StaticResource DateFormat}}" Header="Pakanka iki" MinWidth="{Binding Path=ActualWidth, ElementName=projectInfoHeader }" IsReadOnly="True"/>
                <DataGridTextColumn Binding="{Binding QuantityValue, Converter={StaticResource NumberFormat}}" Header="Kiekis" MinWidth="{Binding Path=ActualWidth, ElementName=projectInfoHeader }" IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>
        <local:Navigation x:Name="navigation" Grid.Row="2" Grid.ColumnSpan="7" PageCount="{Binding PageCount}" PageIndex="{Binding PageIndex}" NavigationClick="{Binding PageIndexChangedCommand}" IsBusy="{Binding IsBusy}"/>
    </Grid>
</UserControl>
